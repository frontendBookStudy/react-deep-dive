# 13장: 웹페이지의 성능을 측정하는 다양한 방법

## 13.1 애플리케이션에서 확인하기

### React (create-react-app)

- reportWebVitals
    - 웹에서 성능을 측정하기 위한 함수
    - 누적 레이아웃 이동(CLS), 최초 콘텐츠풀 페인트(FCP), 최초 콘텐츠 페인팅(LCP), 첫 바이트까지의 시간(TTFB)을 측정하는 용도로 사용
    - web-vitals 라이브러리를 사용하여 측정
    - PerformanceObserver API를 사용한다
        - 브라우저에서 웹페이지의 성능을 측정하기 위해 사용

### Next.js (create-next-app)

- NextWebVitalsMetric
    - Next.js에서 제공하는 성능 측정 도구
    - 기본적인 핵심 웹 지표 외에도 Next.js에 특화된 사용자 지표도 제공한다
        - Next.js-hydration: 페이지가 서버 사이드에서 렌더링되어 하이드레이션하는 데 걸린 시간
        - Next.js-route-change-to-render: 페이지가 경로를 변경한 후 페이지를 렌더링을 시작하는 데 걸리는 시간
        - Next.js-render: 경로 변경이 완료된 후 페이지를 렌더링하는 데 걸린 시간

## 13.2 구글 라이트하우스

- Google Lighthouse
    - 구글에서 제공하는 웹페이지 성능 측정 도구
    - 탐색 모드
        - 페이지에 접속했을 때부터 페이지 로딩이 완료될 때까지의 성능을 측정하는 모드
        - 페이지를 처음부터 다시 불러와서 페이지 로딩이 끝날 때까지 각각의 지표를 수집
        - 지표 수집이 완료되면 리포트가 생성된다
            - 성능
                - 웹페이지의 성능과 관련된 지표를 확인할 수 있는 영역
                - Time to Interactive: 페이지에서 사용자가 완전히 상호작용할 수 있을 때까지 걸리는 시간
                - Speed Index: 페이지가 로드되는 동안 콘텐츠가 얼마나 빨리 시각적으로 표시되는지를 계산
                - Total Blocking Time: 페이지가 로드되는 동안 사용자 입력에 대한 응답이 지연되는 시간
            - 접근성
                - 웹 접근성: 장애인 및 고령자 등 신체적으로 불편한 사람들이 일반적인 사용자와 동등하게 웹페이지를 이용할 수 있도록 보장하는 것
                - 다양한 사용자를 배려하기 위해 HTML과 CSS 등에 적절한 대안을 삽입하는 것
                - 얼마나 적절하게 접근성을 제공하는지 확인할 수 있는 영역
            - 권장사항
                - 웹사이트를 개발할 때 고려해야 할 요소들을 얼마나 지키고 있는지 확인할 수 있는 영역
            - 검색 엔진 최적화
                - 검색엔진이 쉽게 웹페이지 정보를 가져가서 공개할 수 있도록 최적화되어 있는지를 확인할 수 있는 영역
                - 검색엔진에 최적화되어 있을수록 검색 엔진의 검색결과 우선순위에 높게 나타난다
    - 기간 모드
        - 실제 웹페이지를 탐색하는 동안 지표를 측정
        - 대다수의 사용자가 빈번하게 수행할 것으로 예상되는 작업을 기간 모드로 측정하면 성능 최적화에 큰 도움을 얻을 수 있다
        - 흔적
            - 웹 성능을 추적한 기간을 성능 탭에서 보여준다
            - 상세하게 시간의 흐름에 따라 어떻게 웹페이지가 로딩됐는지를 보여준다
        - 트리맵
            - 트리맵: 페이지를 불러올 때 함께 로딩한 모든 리소스를 함께 모아서 볼 수 있는 곳
            - 자바스크립트 리소스 중 어떠한 파일이 전체 데이터 로딩 중 어느 정도를 차지했는지를 비율로 확인
            - 로딩한 리소스에서 사용하지 않은 바이트의 크기를 확인
    - 스냅샷
        - 현재 페이지 상태를 기준으로 분석한다
        - 페이지 로딩이 아닌 특정 페이지 특정 상태를 기준으로 분석하고 싶을 때 사용

## 13.3 WebPageTest

- WebPageTest
    - 웹사이트 성능을 분석하는 도구
    - WebPageTest에서 제공하는 분석 도구
        - Site Performance: 웹사이트의 성능 분석을 위한 도구
        - Core Web Vitals: 웹사이트의 핵심 웹 지표를 확인하기 위한 도구
        - Lighthouse: 구글 라이트하우스 도구
        - Visual Comparison: 2개 이상의 사이트를 동시에 실행해 시간의 흐름에 따른 로딩 과정을 비교하는 도구
        - Traceroute: 네트워크 경로를 확인하는 도구
    - https://www.webpagetest.org/ 에서 테스트를 할 수 있다
- 테스트 결과 분석
    - Performance summary
        - Opportunities & Experiments: 웹사이트에 대한 평가를 보여준다
            - Is it Quick: 웹사이트가 충분히 빠른지 평가
            - Is it Usable: 웹사이트의 사용성과 시각적인 요소를 확인
            - Is it Resilient: 보안 취약성을 점검
        - Observed Metrics: 최초 바이트까지의 시간, 렌더링 시작에 소요되는 시간, 최초 콘텐츠풀 페인트 등 측정할 수 있는 다양한 시간 지표를 보여준다
        - Individual Runs: 3번의 테스트를 진행 후, 각각에 대해 실행 결과를 보여준다
    - Opportunities & Experiments
        - Performance summary에서 간단하게 보여준 결과를 자세하게 보여준다
            - 최초 바이트까지의 시간 점검
            - 렌더링을 블로킹하는 자바스크립트가 있는지 확인
            - 렌더링을 블로킹하는 CSS가 있는지 확인
            - 최초 콘텐츠풀 페인트가 2.5초 이내인지 확인
            - 주요 영역 내에 게으른 로딩괴는 이미지가 있는지 확인
            - 주요 영역 외에 이미지가 게으르게 로딩되는지 확인
            - 문자의 노출을 지연시키는 커스텀 폰트가 있는지 확인
            - 제3자 호스트에서 폰트를 불러오는지 확인
            - 실제로 사용하지 않는 리소르를 `rel=preload`로 불러오지 않는지 확인
            - HTTP 리다이렉트되는 리소스가 있는지 확인
            - 최초로 다운로드 받은 HTML과 최종 결좌물 HTML 사이에 크기 차이가 크지 않은지 확인
    - Filmstrip
        - 시간의 흐름에 따라 어떻게 웹사이트가 그려졌는지, 어떤 리소스가 불러와졌는지 보여준다
    - Details
        - Filmstrip 메뉴에서 보여준 내용을 자세하게 보여준다
    - Web Vitals
        - 최대 콘텐츠풀 페인트, 누적 레이아웃 이동, 총 블로킹 시간을 자세하게 보여준다
    - Optimizations
        - 리소스들이 얼마나 최적화되어 있는지 보여준다
    - Content
        - 웹사이트에서 제공하는 콘텐츠, 애셋을 종류별로 묶어 통계를 보여준다
    - Domains
        - Content 메뉴에서 보여준 애셋들이 어느 도메인에서 왓는지를 도메인별로 묶어서 보여준다
    - Console Log
        - 사용자가 웹페이지에 접속했을 때 `console.log`로 무엇이 기록되었는지 보여준다
    - Detected Technologies
        - 웹사이트를 개발하는 데 사용된 기술을 보여준다
    - Main-thread Processing
        - 메인 스레드가 어떤 작업을 처리했는지 보여준다
    - Lighthouse Report
        - 구글 라이트하우스 리포트를 보여준다

## 13.4 크롬 개발자 도구

- 웹사이트의 성능 이슈를 파악하기 위해 크롬 개발자 도구를 활용한다
- Performance Insights
    - 웹사이트의 성능을 자세하게 확인할 수 있다
    - Throttling을 사용하여 고의로 네트워크와 CPU 속도를 지연시킬 수 있다
    - 성능을 측정하기 전에 반드시 뷰포트를 실제 사용자가 보는 크기만큼 설정해야 한다
    - Insights
        - 성능을 측정하는 기간동안 발생한 이벤트 중 눈여겨봐야 할 내용을 시간의 흐름에 따라 모아서 보여준다
        - 핵심 웹지표
        - User Timing API로 측정한 지표
        - 메인 스레드에서 실행되는데 오랜 시간으로 분류된 긴 작업
        - 렌더링을 막는 CSS 확인
        - 스타일을 재계산하는 일이 발생했는지 확인
    - 메인 메뉴
        - 성능을 측정하는 기간동안 무슨 일이 일어나는지 확인할 수 있다
            - 시간의 흐름에 따라 화면이 얼마나 그려졌는지 점검
            - 레이아웃 이동이 일어났는지 확인
            - 성능 측정 기간동안 발생한 네트워크 요청 확인
            - 렌더러가 어떤 작업을 하고있는지 확인
    - 성능
        - 성능 분석에 사용할 수 있도록 복잡하지만 자세한 정보를 보여준다
        - 측정 기간의 CPU, 네트워크 요청, 스크린샷, 메모리 점유율 등을 요약해서 보여준다
        - 성능 측정 기간동안에 발생한 모든 네트워크 요청을 보여준다
        - 실제 다운로드를 시작하기 위해 대기하는 시간과 다운로드에 걸리는 시간을 보여준다
        - 핵심 웹 지표 시점을 확인할 수 있다
        - 시간의 흐름에 따라 메인 스레드의 작업은 어떻게 이뤄졌는지 보여준다
        - 자바스크립트 힙 영역은 어떻게 변화하는지 보여준다
